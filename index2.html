<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Visualizador 3D de Muebles ¬∑ SW7036</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      :root {
        --sw7036: #d0c4b3;
        --sw7036-50: #f7f4f0;
        --sw7036-100: #ece6de;
        --sw7036-200: #e2d9cc;
        --sw7036-300: #d9cfbf;
        --sw7036-400: #cbbda9;
        --sw7036-500: #b6a690;
        --sw7036-600: #a28f79;
        --ink: #2a2a2a;
        --muted: #6b6b6b;
        --accent: #8c6d4f;
        --success: #3aa981;
        --shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        --radius: 16px;
      }
      * { box-sizing: border-box; }
      html, body { height: 100%; }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto,
          Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
        color: var(--ink);
        background: linear-gradient(180deg,var(--sw7036-50) 0%,var(--sw7036-100) 100%);
        overflow: hidden;
      }
      .header {
        position: absolute;
        inset: 16px 16px auto 16px;
        z-index: 20;
        display: flex;
        align-items: center;
        justify-content: space-between;
        background: rgba(255, 255, 255, 0.65);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: var(--radius);
        padding: 10px 14px;
        box-shadow: var(--shadow);
        gap: 12px;
      }
      .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; }
      .dot {
        width: 10px; height: 10px; border-radius: 999px; background: var(--accent);
        box-shadow: 0 0 0 3px rgba(140, 109, 79, 0.15);
      }
      .panel {
        position: absolute; top: 76px; left: 16px; bottom: 16px; width: 330px;
        z-index: 15; background: rgba(255, 255, 255, 0.78);
        backdrop-filter: blur(8px);
        border: 1px solid rgba(0, 0, 0, 0.06);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 16px;
        display: grid;
        grid-template-rows: auto 1fr auto;
        gap: 14px;
      }
      .section { display: grid; gap: 8px; }
      .section h3 {
        margin: 0; font-size: 14px; letter-spacing: 0.3px;
        color: var(--muted); text-transform: uppercase;
      }
      select, button, input[type="range"] {
        width: 100%; padding: 10px 12px;
        border-radius: 12px; border: 1px solid rgba(0,0,0,0.08);
        background: white; color: var(--ink);
        font-weight: 500; outline: none;
      }
      select:focus, button:focus, input[type="range"]:focus {
        box-shadow: 0 0 0 4px rgba(140, 109, 79, 0.15);
        border-color: var(--accent);
      }
      .btn {
        background: var(--accent); color: #fff; border: none; cursor: pointer;
        font-weight: 600; transition: transform 0.06s ease, box-shadow 0.2s ease, background 0.2s ease;
        box-shadow: 0 6px 18px rgba(140, 109, 79, 0.35);
      }
      .btn:hover { filter: brightness(1.03); }
      .btn:active { transform: translateY(1px); }
      .row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
      .textures {
        display: grid; grid-template-columns: repeat(3, 1fr);
        gap: 10px; align-content: start; overflow: auto; padding-right: 4px;
      }
      .texItem {
        position: relative; border-radius: 12px; overflow: hidden; cursor: pointer;
        height: 78px; border: 2px solid transparent; background: #fff;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
      }
      .texItem img { width: 100%; height: 100%; object-fit: cover; display: block; }
      .texItem.selected {
        border-color: var(--accent);
        box-shadow: 0 0 0 4px rgba(140, 109, 79, 0.15), 0 6px 16px rgba(0,0,0,0.08);
      }
      .texBadge {
        position: absolute; left: 8px; bottom: 8px; font-size: 10px; font-weight: 700;
        padding: 4px 6px; border-radius: 999px; color: #fff; background: rgba(0, 0, 0, 0.55);
      }
      .footerNote { font-size: 12px; color: var(--muted); }
      #stage { position: absolute; inset: 0; }
      .loader {
        position: absolute; inset: 0; display: grid; place-items: center;
        pointer-events: none; z-index: 12;
        background: radial-gradient(1200px 600px at 50% 50%, rgba(240,234,226,0.35), rgba(240,234,226,0));
      }
      .spinner {
        width: 44px; height: 44px; border-radius: 999px;
        border: 4px solid rgba(0,0,0,0.08); border-top-color: var(--accent);
        animation: spin 1s linear infinite;
        box-shadow: 0 0 0 4px rgba(140, 109, 79, 0.08) inset;
      }
      @keyframes spin { to { transform: rotate(360deg); } }
      @media (max-width: 860px) {
        .panel { width: calc(100% - 32px); left: 16px; right: 16px; top: auto; bottom: 16px; height: 56vh; }
        .header { inset: 16px 16px auto 16px; }
        .textures { grid-template-columns: repeat(4, 1fr); }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="brand">
        <span class="dot"></span> Visualizador 3D de Muebles
      </div>
      <div style="font-size: 12px; color: var(--muted); font-weight: 600">
        Paleta ¬∑ SW7036
      </div>
    </div>

    <aside class="panel">
      <div class="section">
        <h3>Mueble</h3>
        <select id="muebleSelect">
          <option value="">-- Selecciona un mueble --</option>
        </select>
      </div>
      <div class="section" style="min-height: 120px">
        <h3>Texturas</h3>
        <div id="texturesGrid" class="textures"></div>
      </div>
      <div class="section">
        <h3>Ajustes de Material</h3>
        <div class="row">
          <div>
            <label for="scaleInput" style="font-size:12px;color:var(--muted);font-weight:600">Escala (tile)</label>
            <input id="scaleInput" type="range" min="0.25" max="4" step="0.25" value="1" />
          </div>
          <div>
            <label for="roughInput" style="font-size:12px;color:var(--muted);font-weight:600">Rugosidad</label>
            <input id="roughInput" type="range" min="0" max="1" step="0.05" value="0.6" />
          </div>
        </div>
        <div class="row" style="margin-top: 8px">
          <button id="toggleEnv" class="btn" type="button">üå§Ô∏è Iluminaci√≥n HDRI</button>
          <button id="captureBtn" class="btn" type="button">üì∏ Capturar PNG</button>
        </div>
        <div class="footerNote">Consejo: gira con un dedo (t√°ctil) o mouse; zoom con pinza o rueda.</div>
      </div>
    </aside>

    <div id="stage"></div>
    <div class="loader" id="loader"><div class="spinner"></div></div>

    <!-- Three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/loaders/RGBELoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.156.1/examples/js/loaders/DRACOLoader.js"></script>

    <script>
      const MODELS = [
        { label: "Federico Kalos", file: "models/federico kalos.glb", scale: 0.01 },
        { label: "Mesa de Luz", file: "models/mesa de luz.glb", scale: 0.01 },
      ];
      const TEXTURES = [
        { name: "AMARANTO", file: "texturas/AMARANTO.webp" },
        { name: "BALTICO", file: "texturas/BALTICO.webp" },
        { name: "BLANCO NATURE", file: "texturas/BLANCO NATURE.webp" },
        { name: "CALACATTA", file: "texturas/calacatta.webp" },
        { name: "CAMELLIA", file: "texturas/CAMELLIA.webp" },
        { name: "CARVALHO MEZZO", file: "texturas/CARVALHO MEZZO.webp" },
        { name: "CHIARO", file: "texturas/CHIARO.webp" },
        { name: "EVEREST", file: "texturas/EVEREST.webp" },
      ];

      let scene, camera, renderer, controls;
      let currentModel = null, currentTexture = null, envEnabled = true, hdrMap = null;
      let stage = document.getElementById("stage");
      let loaderEl = document.getElementById("loader");

      initUI(); init3D();

      function initUI() {
        const sel = document.getElementById("muebleSelect");
        MODELS.forEach((m, i) => {
          const opt = document.createElement("option");
          opt.value = i; opt.textContent = m.label;
          sel.appendChild(opt);
        });
        sel.addEventListener("change", e => {
          if (e.target.value !== "") loadModel(MODELS[e.target.value]);
        });

        const grid = document.getElementById("texturesGrid");
        TEXTURES.forEach((t, i) => {
          const item = document.createElement("button");
          item.className = "texItem";
          item.innerHTML = `<img src="${t.file}" alt="${t.name}"><span class="texBadge">${t.name}</span>`;
          if (i === 0) item.classList.add("selected");
          item.addEventListener("click", () => {
            document.querySelectorAll(".texItem").forEach(el => el.classList.remove("selected"));
            item.classList.add("selected"); applyTexture(t.file);
          });
          grid.appendChild(item);
        });

        document.getElementById("scaleInput").addEventListener("input", e => setTextureScale(parseFloat(e.target.value)));
        document.getElementById("roughInput").addEventListener("input", e => setRoughness(parseFloat(e.target.value)));
        document.getElementById("toggleEnv").addEventListener("click", () => { envEnabled=!envEnabled; scene.environment=envEnabled?hdrMap:null; });
        document.getElementById("captureBtn").addEventListener("click", () => {
          renderer.render(scene, camera);
          const link=document.createElement("a");
          link.download="mueble.png"; link.href=renderer.domElement.toDataURL("image/png"); link.click();
        });
      }

      function init3D() {
        scene = new THREE.Scene(); scene.background = new THREE.Color("#efe9e1");
        camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(2.2, 1.9, 3.2);
        renderer = new THREE.WebGLRenderer({antialias:true});
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled=true; renderer.shadowMap.type=THREE.PCFSoftShadowMap;
        stage.appendChild(renderer.domElement);
        controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; controls.target.set(0,0.5,0);
        scene.add(new THREE.HemisphereLight(0xffffff,0x888888,0.35));

        const dirLight=new THREE.DirectionalLight(0xffffff,1);
        dirLight.position.set(5,10,7.5); dirLight.castShadow=true; dirLight.shadow.mapSize.set(1024,1024);
        scene.add(dirLight);

        const floor=new THREE.Mesh(new THREE.PlaneGeometry(12,12),new THREE.ShadowMaterial({opacity:0.28}));
        floor.rotation.x=-Math.PI/2; floor.receiveShadow=true; scene.add(floor);

        new THREE.RGBELoader().setDataType(THREE.UnsignedByteType)
          .load("https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/studio_small_03_1k.hdr", tex=>{
            tex.mapping=THREE.EquirectangularReflectionMapping;
            hdrMap=tex; scene.environment=envEnabled?hdrMap:null;
          });

        window.addEventListener("resize",()=>{
          camera.aspect=window.innerWidth/window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth,window.innerHeight);
        });
        animate();
      }

      function showLoader(show){loaderEl.style.opacity=show?"1":"0";loaderEl.style.visibility=show?"visible":"hidden";}

      const gltfLoader = new THREE.GLTFLoader();
      const dracoLoader = new THREE.DRACOLoader();
      dracoLoader.setDecoderPath("https://www.gstatic.com/draco/v1/decoders/");
      gltfLoader.setDRACOLoader(dracoLoader);

      function loadModel(model){
        showLoader(true);
        if(currentModel){scene.remove(currentModel);currentModel=null;}
        gltfLoader.load(model.file, gltf => {
          currentModel = gltf.scene;
          currentModel.scale.set(model.scale, model.scale, model.scale);
          currentModel.traverse(child => {
            if (child.isMesh) {
              child.castShadow = true;
              child.receiveShadow = true;
            }
          });
          const box = new THREE.Box3().setFromObject(currentModel),
                size = new THREE.Vector3(),
                center = new THREE.Vector3();
          box.getSize(size);
          box.getCenter(center);
          currentModel.position.sub(center.multiplyScalar(1));
          currentModel.position.y = size.y * 0.5;
          scene.add(currentModel);
          applyTexture(TEXTURES[0].file);
          showLoader(false);
        }, undefined, err => {
          console.error("Error al cargar modelo", err);
          showLoader(false);
          alert("No se pudo cargar el modelo: " + model.label);
        });
      }

      const texLoader=new THREE.TextureLoader();
      function applyTexture(path){
        if(!currentModel) return; 
        showLoader(true);
        texLoader.load(path,tex=>{
          currentTexture=tex; 
          tex.wrapS=tex.wrapT=THREE.RepeatWrapping;
          tex.anisotropy=renderer.capabilities.getMaxAnisotropy();
          setTextureScale(parseFloat(document.getElementById("scaleInput").value));
          const rough=parseFloat(document.getElementById("roughInput").value);
          currentModel.traverse(child=>{
            if(child.isMesh){
              child.material=new THREE.MeshStandardMaterial({
                map:tex,
                roughness:rough,
                metalness:0,
                envMap:scene.environment
              });
            }
          });
          showLoader(false);
        },undefined,()=>{
          alert("No se pudo cargar la textura.");
          showLoader(false);
        });
      }

      function setTextureScale(s){
        if(currentTexture){
          currentTexture.repeat.set(s,s);
          currentTexture.needsUpdate=true;
        }
      }

      function setRoughness(v){
        if(currentModel){
          currentModel.traverse(child=>{
            if(child.isMesh && child.material){
              child.material.roughness=v;
            }
          });
        }
      }

      function animate(){
        requestAnimationFrame(animate);
        controls.update();
        renderer.render(scene,camera);
      }
    </script>
  </body>
</html>
